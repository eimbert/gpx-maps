<div class="map-wrap" [class.aspect-vertical]="isVerticalViewport">
  <div id="map"></div>

  <!-- UI superpuesta -->
  <div class="map-ui" aria-label="Cabecera de comparaci√≥n">
    <div class="map-logo" *ngIf="logoDataUrl">
      <img [src]="logoDataUrl" alt="logo carrera">
    </div>

    <div class="map-title">
      <ng-container *ngFor="let track of trackMetas; let last = last">
        <span class="title-chip" [style.borderColor]="track.color" [style.color]="track.color" [title]="track.name">{{ track.name }}</span>
        <span class="vs" *ngIf="!last">VS</span>
      </ng-container>
    </div>

    <div class="map-controls" role="group" aria-label="Seleccionar mapa base">
      <label class="control-label" for="base-layer-select">Mapa:</label>
      <select
        id="base-layer-select"
        class="base-layer-select"
        [ngModel]="selectedBaseLayerId"
        (ngModelChange)="onBaseLayerChange($event)"
        aria-label="Cambiar mapa base"
      >
        <option *ngFor="let option of baseLayerOptions" [value]="option.id">
          {{ option.name }}
        </option>
      </select>
    </div>

    <button type="button" class="start-btn" (click)="goBack()">Anterior</button>
    <!-- <a class="stop-rec" (click)="stopRecordingAndDownload()" *ngIf="rec.isRecording">‚èπ Stop & Download</a> -->
  </div>

  <!-- ‚¨áÔ∏è Overlay de inicio -->
  <div class="start-overlay" *ngIf="showStartOverlay">
    <div class="countdown">
      <div class="countdown-number" [class.go]="countdownValue === 'GO'">
        {{ countdownValue || '...' }}
      </div>
      <div class="countdown-subtitle">La carrera empieza en</div>
    </div>
  </div>

  <div class="info-overlay" *ngIf="showUniformSpeedDialog">
    <div class="info-dialog" role="dialog" aria-modal="true" aria-label="Aviso de reproducci√≥n uniforme">
      <p>El track cargado no contiene informaci√≥n del tiempo, por lo que la representaci√≥n se realizar√° uniformemente sin tener en cuenta tramos m√°s r√°pidos o lentos y se mostrar√° a velocidad constante.</p>
      <button type="button" class="info-btn" (click)="dismissUniformSpeedDialog()">Entendido</button>
    </div>
  </div>

  <div class="ranking-overlay" *ngIf="showRanking && ranking.length">
    <div class="ranking-panel" aria-label="Clasificaci√≥n final">
      <div class="ranking-title">üèÅ Ranking final</div>
      <ol class="ranking-list">
        <li *ngFor="let item of ranking; index as i" [class.top-entry]="i < 3">
          <div class="ranking-medal" [ngClass]="item.medal">
            <span *ngIf="item.medal">{{ item.medal === 'gold' ? 'ü•á' : item.medal === 'silver' ? 'ü•à' : 'ü•â' }}</span>
            <span *ngIf="!item.medal" class="ranking-number">#{{ i + 1 }}</span>
          </div>
          <div class="ranking-runner">
            <span class="runner-name" [style.color]="item.color" [style.borderColor]="item.color" [title]="item.name">{{ item.name }}</span>
            <span class="runner-time">{{ formatRaceTime(item.durationMs) }}</span>
          </div>
        </li>
      </ol>
    </div>
  </div>

  <div class="profile-overlay" aria-label="Perfil de elevaci√≥n">
    <ng-container *ngIf="profileEnabled; else profileDisabled">
      <div class="profile-panel" *ngIf="profileVisual; else profileUnavailable">
        <svg
          class="profile-chart"
          [attr.viewBox]="'0 0 ' + profileWidth + ' ' + profileHeight"
          preserveAspectRatio="none"
        >
          <line
            *ngFor="let y of profileVisual.gridLinesY"
            class="profile-grid"
            x1="0"
            [attr.y1]="y"
            [attr.x2]="profileWidth"
            [attr.y2]="y"
          />
          <polyline class="profile-polyline" [attr.points]="profileVisual.points"></polyline>
          <line
            class="profile-cursor"
            [attr.x1]="profileCursorX"
            [attr.x2]="profileCursorX"
            y1="0"
            [attr.y2]="profileHeight"
          ></line>
        </svg>
      </div>
    </ng-container>
  </div>

  <ng-template #profileDisabled>
    <div class="profile-message">Perfil desactivado</div>
  </ng-template>
  <ng-template #profileUnavailable>
    <div class="profile-message">Perfil no disponible</div>
  </ng-template>
</div>
<!-- Overlay Start ya lo tienes -->



<audio
  id="background-music-carrera"
  src="assets/musica/carrera.mp3"
  preload="auto"
  playsinline
  loop
></audio>

<audio
  id="countdown-sound"
  src="assets/musica/inicio.mp3"
  preload="auto"
  playsinline
></audio>
